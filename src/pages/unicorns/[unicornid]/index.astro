---
import Document from "../../../layouts/document.astro";
import SEO from "components/seo/seo.astro";
import UnicornsPage from "src/views/unicorn/unicorn-page.astro";
import { getPostsByUnicorn } from "utils/api";
import { ExtendedPostInfo } from "types/index";
import { unicorns } from "utils/data";
import { Page } from "astro";

export async function getStaticPaths() {
	return unicorns.map((unicorn) => ({ params: { unicornid: unicorn.id } }));
}

const params = Astro.params as { unicornid: string };

const unicorn = unicorns.find((unicorn) => unicorn.id === params.unicornid);

const enPosts = getPostsByUnicorn(unicorn.id, "en");
const postsToDisplay = enPosts.slice(0, 8);

const page = {
	total: enPosts.length,
	currentPage: 1,
	size: postsToDisplay.length,
	lastPage: Math.floor(enPosts.length / postsToDisplay.length),
	url: {
		current: `/unicorns/${unicorn.id}`,
		next: `/unicorns/${unicorn.id}/page/2`,
	},
} as Page<ExtendedPostInfo>;

const rootURL = `/unicorns/${unicorn.id}/`;
---

<Document>
	<SEO
		slot="head"
		title={unicorn.name}
		description={unicorn.description}
		unicornsData={[unicorn]}
		type="profile"
	/>
	<div class="listViewContent">
		<UnicornsPage
			unicorn={unicorn}
			page={page}
			posts={postsToDisplay}
			allPosts={enPosts}
			rootURL={rootURL}
		/>
	</div>
</Document>
