---
import { getFullRelativePath } from "utils/url-paths";
import SEO from "src/components/seo/seo.astro";
import Document from "src/layouts/document.astro";
import { ExtendedCollectionInfo } from "types/CollectionInfo";
import { MarkdownInstance } from "astro";
import { getPostsByCollection } from "utils/api";
import CollectionPage from "src/page-components/collections/collection-page.astro";

export async function getStaticPaths() {
	const collections = await Astro.glob(
		"../../../content/collections/**/index.md"
	);

	return collections.map((collection) => {
		return {
			params: {
				slug: collection.frontmatter.slug,
			},
			props: {
				Content: collection.Content,
				collection: collection.frontmatter,
			},
		};
	});
}

interface CollectionProps {
	collection: ExtendedCollectionInfo;
	Content: MarkdownInstance<never>["Content"];
}

const { Content, collection } = Astro.props as CollectionProps;

const { slug } = collection;

// TODO: support localization
const collectionPosts = getPostsByCollection(slug, "en");

const coverImgPath = getFullRelativePath(
	"/content/collections",
	slug,
	collection.coverImg
);
---

<Document>
	<SEO
		slot="head"
		title={collection.title}
		description={collection.description}
		unicornsData={collection.authorsMeta}
		publishedTime={collection.published}
		type={collection.type}
		shareImage={collection.socialImg || coverImgPath}
	/>
	<CollectionPage Content={Content} collection={collection} coverImgPath={coverImgPath}/>
</Document>
