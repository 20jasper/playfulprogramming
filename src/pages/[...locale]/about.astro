---
import * as fs from "fs/promises";
import Document from "src/layouts/document.astro";
import SEO from "components/seo/seo.astro";
import AboutView from "src/views/about/about.astro";
import { getLanguageFromFilename, translate } from "utils/translations";
import { join } from "path";
import { contentDirectory } from "utils/data";
import { getMarkdownHtml } from "utils/markdown";
import { Languages } from "types/index";

export async function getStaticPaths() {
	const files = (await fs.readdir(join(contentDirectory, "site")))
		.filter((filename) => filename.startsWith("about-us"))
		.map((filename) => ({
			file: join(contentDirectory, "site", filename),
			locale: getLanguageFromFilename(filename),
		}));

	return files.map((data) => {
		return {
			params: {
				locale: data.locale !== "en" ? data.locale : undefined,
			},
			props: {
				file: data.file,
				locales: files.map((d) => d.locale),
			},
		};
	});
}

interface Props {
	file: string;
	locales: Languages[];
}

const { file, locales } = Astro.props as Props;
const fileHtml = await getMarkdownHtml({ kind: "page", file });
---

<Document>
	<SEO
		title={translate(Astro, "title.about_us")}
		description={translate(Astro, "desc.about_us")}
		providedLangs={locales}
		slot="head"
	/>
	<AboutView
		locales={locales}
		locale={Astro.params.locale}
		markdownHtml={fileHtml.html}
	/>
</Document>
