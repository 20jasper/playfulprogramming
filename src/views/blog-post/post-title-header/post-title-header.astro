---
import style from "./post-title-header.module.scss";
import { ExtendedPostInfo } from "types/index";
import { Icon } from "astro-icon";
import { Tag } from "components/index";
import { getUnicornProfilePicMap } from "utils/get-unicorn-profile-pic-map";
import dayjs from "dayjs";
import { Picture } from "components/image/picture";

interface PostTitleHeaderProps {
	post: ExtendedPostInfo;
}
const { post } = Astro.props as PostTitleHeaderProps;
const { title, tags } = post;
const unicornProfilePicMap = await getUnicornProfilePicMap();

const publishedStr = dayjs(post.published).format("MMMM D, YYYY");
---

<div class="d-flex gap-2">
	<Icon width="24" height="24" name="mdi:calendar-outline" />
	<p>{publishedStr}</p>
</div>

<h1 class={style.title}>{title}</h1>
<div class="d-flex gap-2">
	<Icon width="24" height="24" name="mdi:person-outline" />
	<ul
		aria-label="Post authors"
		role="list"
		class={`${style.tags} unlist-inline`}
	>
		{
			post.authorsMeta.map((author) => (
				<li>
					<Tag href={`/unicorns/${author.id}`}>
						<Picture
							picture={unicornProfilePicMap.find((u) => u.id === author.id)}
							alt={author.name}
							class="circleImg"
							imgAttrs={{ width: 24, height: 24 }}
						/>
						{author.name}
					</Tag>
				</li>
			))
		}
	</ul>
</div>
{
	tags && tags.length ? (
		<div class="d-flex gap-2">
			<Icon width="24" height="24" name="mdi:tag-outline" />
			<ul
				aria-label="Post tags"
				role="list"
				class={`${style.tags} unlist-inline`}
			>
				{tags.map((tag) => (
					<li>
						<Tag href={`/search?q=${tag}`}>{tag}</Tag>
					</li>
				))}
			</ul>
		</div>
	) : null
}
