---
import { FixedArray } from "../../../../types/ArrayLike";
import InfiniteLoopSlider from "./infinite-loop-slider.astro";
const random = (min, max) => Math.floor(Math.random() * (max - min)) + min;
const shuffle = (arr) => [...arr].sort(() => 0.5 - Math.random());

const MAX_DURATION = 56000 * 2;
const MIN_DURATION = 56000;
const ROWS = 3;
const TAGS_PER_ROW = 10;

export type TagList = Readonly<FixedArray<string, 30>>;

interface ChipGroupProps {
	tags: TagList;
}

const { tags } = Astro.props as ChipGroupProps;
const SHUFFLED_TAGS = shuffle(tags);
const tagTable = [...new Array(ROWS)].map((_, i) =>
	SHUFFLED_TAGS.slice(TAGS_PER_ROW * i, TAGS_PER_ROW * (i + 1))
);
---

<div class="tag-list">
	{
		tagTable.map((_, i) => (
			<InfiniteLoopSlider
				duration={random(MIN_DURATION, MAX_DURATION)}
				reverse={i % 2}
			>
				{tagTable[i].map((tag) => (
					<div class="text-style-body-medium-bold tag">{tag}</div>
				))}
			</InfiniteLoopSlider>
		))
	}
	<div class="fade"></div>
</div>
<style is:global>
	.tag-list {
		margin: 0 auto;
		width: 100%;
		max-width: var(--max-width_large);
		display: flex;
		flex-shrink: 0;
		flex-direction: column;
		gap: var(--chip-group-gap) 0;
		position: relative;
		padding: 1.5rem 0;
		overflow: hidden;
	}

	.tag-list:hover .loop-slider .inner {
		animation-play-state: paused;
	}

	.tag-list:hover .loop-slider .inner {
		animation-play-state: paused;
	}

	@media (prefers-reduced-motion: reduce) {
		.tag-list .loop-slider .inner {
			animation-play-state: paused;
		}
	}

	.tag {
		color: var(--chip-foreground);
		background-color: var(--chip-background);
		border-radius: var(--corner-radius-circular);
		padding: var(--chip-ver-padding) var(--chip-hor-padding);
		/* Must used margin-right instead of gap for the loop to be smooth */
		margin-right: var(--chip-group-gap);
		white-space: nowrap;
	}

	.fade {
		pointer-events: none;
		background: linear-gradient(
			90deg,
			var(--section-background),
			transparent 30%,
			transparent 70%,
			var(--section-background)
		);
		position: absolute;
		inset: 0;
	}
</style>
